<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Rutas Koox Campeche</title>
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="manifest" href="manifest.json">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <link rel="stylesheet" href="style.min.css" />
    <style>
        /* Reglas cr√≠ticas para evitar el "Flash of Unstyled Content" (FOUC) */
        .oculto { 
            display: none !important; 
        }
        #panel-control, #panel-navegacion, #info-modal {
            position: absolute;
        }
    </style>
</head>
<body>
    <div id="offline-indicator" class="oculto">
        Est√°s sin conexi√≥n. La app seguir√° funcionando.
    </div>
    <div id="alert-indicator" class="alerta-comunitaria oculto">
        </div>
    <div id="map"></div>
    <button id="btn-fab-reporte" class="fab-reporte" title="Reportar Incidente">
        ‚ö†Ô∏è
    </button>

    <div id="panel-control" class="oculto">
        <div class="panel-header">
            <h3>Gu√≠a de Rutas Koox</h3>
            <button id="btnInfo" class="info-btn">i</button>
        </div>
        
        <div class="tab-switch">
            <button id="btnModoViaje" class="tab-btn activo">Calcular Viaje</button>
            <button id="btnModoExplorar" class="tab-btn">Explorar Rutas</button>
            <button id="btnModoReporte" class="tab-btn">Reportar</button>
        </div>

        <div id="panel-viaje"> 
            <div id="controles-viaje">
                
                <div id="control-input-inicio" class="control-grupo">
                    <label for="inputInicio">Inicio:</label>
                    <input type="text" id="inputInicio" value="Detectando tu ubicaci√≥n..." readonly>
                </div>

                <div id="control-select-inicio" class="control-grupo" style="display: none;">
                    <label for="selectInicioManual">Inicio:</label>
                    <select id="selectInicioManual">
                        <option value="">Escribe o selecciona un inicio...</option>
                    </select>
                </div>

                <div class="control-grupo">
                    <label for="selectDestino">Destino:</label>
                    <select id="selectDestino">
                        <option value="">Escribe o selecciona un destino...</option>
                    </select>
                </div>
            </div>
            <div id="panel-instrucciones">
                <p id="instrucciones">Selecciona tu destino para ver la ruta.</p>
            </div>
            <button id="btnIniciarRuta" style="display:none;">Iniciar Ruta</button>
            <button id="btnLimpiar" style="display:none;">Nueva B√∫squeda</button>
        </div>
        
        <div id="panel-explorar" class="oculto">
            <div id="controles-explorar">
                <div class="control-grupo">
                    <button id="btnParaderosCercanos" class="btn-primario-full">
                        üìç Ver Paraderos Cerca de M√≠
                    </button>
                </div>
                <div class="control-grupo">
                    <label for="selectRuta">Selecciona una Ruta:</label>
                    <select id="selectRuta">
                        <option value="">Escribe o selecciona una ruta...</option>
                    </select>
                </div>
            </div>
            <div id="panel-instrucciones-explorar">
                <p id="instrucciones-explorar">Selecciona una ruta para ver su trayecto y paraderos.</p>
            </div>
            <button id="btnLimpiarExplorar">Limpiar Mapa</button>
        </div>

        <div id="panel-reporte" class="oculto">
            <div id="controles-reporte">
                <div class="info-seccion">
                    <h5>Reporte Oficial (ARTEC)</h5>
                    <p>Para un reporte formal, contacta directamente a la agencia:</p>
                    <div class="info-botones-contacto">
                        <a href="tel:9818119222" class="btn-info-accion">
                            üìû Llamar (981 811 9222)
                        </a>
                        <a href="mailto:atencion.artec@campeche.gob.mx" class="btn-info-accion btn-secundario">
                            ‚úâÔ∏è Enviar Correo
                        </a>
                    </div>
                </div>

                <div class="info-seccion">
                    <h5>Reporte Comunitario (Pr√≥ximamente)</h5>
                    <p>Ayuda a otros usuarios reportando un problema en tu ruta actual. (Funci√≥n en desarrollo)</p>
                    
                    <div class="reporte-botones-grupo">
                        <button class="btn-reporte" data-tipo="RETRASO_GRAVE">üöå Retraso Grave</button>
                        <button class="btn-reporte" data-tipo="BUS_LLENO">üßç Bus Lleno</button>
                        <button class="btn-reporte" data-tipo="PARADA_OMITIDA">üõë Parada Omitida</button>
                        <button class="btn-reporte" data-tipo="RUTA_INCORRECTA">üó∫Ô∏è Ruta Incorrecta</button>
                    </div>
                    </div>
            </div>
        </div>

    </div> <div id="panel-navegacion" class="oculto">
        <div id="instruccion-actual">Cargando instrucci√≥n...</div>
        
        <div id="nav-estado">
            <strong id="distancia-restante">Faltan: ...</strong>
            <strong id="tiempo-viaje" style="font-size: 0.9em;">Viaje: 0:00</strong>
            <strong id="tiempo-espera">Esperando: 0:00</strong>
        </div>

        <div id="controles-nav">
            <button id="btnAnterior" disabled>Anterior</button>
            <button id="btnSiguiente">Siguiente</button>
            <button id="btnFinalizar" style="display: none;">Finalizar</button>
        </div>
    </div>

    <div id="panel-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </div>
    <div id="info-modal" class="modal-overlay oculto">
        <div class="modal-content">
            <span id="btnCloseModal" class="modal-close">&times;</span>
            <h4>Informaci√≥n de Tarifas y Servicio</h4>
            <div class="info-seccion">
                <h5>Tarifas Oficiales</h5>
                <p><strong>Pasaje General:</strong> $12.00 MXN</p>
                <p><strong>Tarifa Social (Estudiantes/INAPAM):</strong> $6.00 MXN</p>
            </div>
            <div class="info-seccion">
                <h5>Transbordos</h5>
                <p>Tu primer y segundo transbordo tienen costo.</p>
                <p><strong>¬°Tu 3er transbordo es GRATIS!</strong></p>
                <p><strong>Importante:</strong> Para que el transbordo gratuito sea v√°lido, debe realizarse dentro de un periodo de **2 horas** desde el inicio de tu primer viaje.</p>
            </div>
            <div class="info-seccion">
                <h5>Horarios (Aproximados)</h5>
                <p>El servicio de rutas opera generalmente de:</p>
                <p><strong>Lunes a Viernes:</strong> 5:00 AM - 11:00 PM</p>
                <p><strong>Sabados y Domingos:</strong> 5:00 AM - 10:00 PM</p>

                <p><small>Los horarios pueden variar por ruta y d√≠a festivo.</small></p>
            </div>
            <div class="info-seccion">
                <h5>¬øDudas o Reportes?</h5>
                <p>Contacta a la Agencia Reguladora del Transporte (ARTEC):</p>
                <div class="info-botones-contacto">
                    <a href="tel:9818119222" class="btn-info-accion">
                        üìû Llamar (981 811 9222)
                    </a>
                    <a href="mailto:atencion.artec@campeche.gob.mx" class="btn-info-accion btn-secundario">
                        ‚úâÔ∏è Enviar Correo
                    </a>
                </div>
            </div>
        </div>
    </div> 
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>
    <script src='https://unpkg.com/@turf/turf@6/turf.min.js' defer></script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js" defer></script>
    <script src="js/app.min.js" type="module"></script>
</body>
</html>